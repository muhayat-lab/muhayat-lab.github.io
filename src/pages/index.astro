---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// ambil semua kursus dari src/content/courses
const courses = await getCollection("courses");
const list = courses.sort((a, b) => a.data.title.localeCompare(b.data.title));

// ambil artikel (koleksi posts)
const posts = (await getCollection("posts"))
  .sort((a, b) => (b.data.date ?? 0) - (a.data.date ?? 0))
  .slice(0, 4); // tampilkan 4 terbaru
---

<BaseLayout title="Muhayat Techlabs" description="Website pribadi dosen: materi kuliah, artikel, dan pengumuman.">
  <!-- ========================= HERO ========================= -->
  <section class="py-10 md:py-14">
    <div class="mx-auto max-w-6xl px-4 sm:px-6 grid gap-8 md:grid-cols-2 md:items-center">
      <div>
        <p class="uppercase tracking-wide text-sm font-semibold text-[var(--brand)]">
          Website Development & Teaching
        </p>
        <h1 class="mt-2 text-4xl md:text-5xl font-extrabold leading-tight">
          Welcome! <span class="text-[var(--brand)]"></span> 
          <span class="text-[var(--brand)]">Explore </span> the latest updates and content
        </h1>
        <p class="mt-4 text-gray-600">
          Repository materi kuliah, artikel, dan pengumuman. Cepat, aman, SEO-friendly.
        </p>

        <div class="mt-6 flex flex-wrap gap-3">
          <a href="/#courses"
             class="inline-flex items-center px-4 py-2 rounded-lg bg-[var(--brand)] text-white hover:bg-[var(--brand-700)]">
            Lihat Courses
          </a>
          <a href="/articles"
             class="inline-flex items-center px-4 py-2 rounded-lg border border-[var(--brand)] text-[var(--brand)]
                    hover:bg-[var(--brand-600)] hover:text-white">
            Artikel Terbaru
          </a>
        </div>
      </div>

      <div class="order-first md:order-none">
        <img src="/hero.jpg" alt="Hero image" class="w-full rounded-3xl shadow-xl ring-1 ring-gray-200/70 object-cover" />
      </div>
    </div>
  </section>

  <!-- ========================= COURSES ========================= -->
  <section id="courses" class="py-10 md:py-14 bg-gradient-to-b from-emerald-50/40 to-transparent">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight text-gray-900">Courses</h2>

      <div class="mt-6 grid gap-6 md:grid-cols-2">
        {list.map((c) => (
          <a href={`/courses/${c.slug}/`}
             class="block rounded-2xl ring-1 ring-gray-200/70 bg-white p-5 hover:shadow-lg transition">
            <h3 class="text-lg font-semibold text-[var(--brand)]">{c.data.title}</h3>
            {c.data.code && <p class="text-xs text-gray-500 mt-1">{c.data.code}</p>}
            {c.data.description && (
              <p class="text-sm text-gray-600 mt-2 line-clamp-3">{c.data.description}</p>
            )}
            <span class="mt-4 inline-flex items-center gap-1 text-sm text-[var(--brand)]">
              Buka materi
              <svg viewBox="0 0 20 20" class="h-4 w-4"><path d="M7 5l5 5-5 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </span>
          </a>
        ))}
      </div>
    </div>
  </section>

<!-- ‚úÖ QOTD Section dengan full background brand -->
<section id="qotd" class="w-full bg-[var(--brand)] py-16 px-4 sm:px-6">
  <div class="max-w-4xl mx-auto text-center text-white">
    <h2 class="text-2xl md:text-3xl font-extrabold mb-6">
      Quote of the Day
    </h2>

    <blockquote
      class="relative bg-white/10 backdrop-blur-sm shadow-md rounded-xl p-6 border-l-4 border-white"
      aria-live="polite"
    >
      <p id="qotd-text" class="text-lg italic text-white">
        ‚ÄúMemuat kutipan terbaik untuk hari ini‚Ä¶‚Äù
      </p>
      <footer id="qotd-author" class="mt-4 text-sm font-semibold text-gray-200">
        ‚Äî ‚Ä¶
      </footer>

      <div class="mt-5 flex justify-center items-center gap-4">
        <button
          id="qotd-refresh"
          class="inline-flex items-center gap-2 text-sm px-3 py-1.5 rounded-md border border-white hover:bg-white hover:text-[var(--brand)] transition"
        >
          üîÑ Shuffle
        </button>
        <span class="text-xs text-gray-200">Source: ZenQuotes</span>
      </div>
    </blockquote>
  </div>

  <script>
    (() => {
      const textEl   = document.getElementById("qotd-text");
      const authorEl = document.getElementById("qotd-author");
      const btn      = document.getElementById("qotd-refresh");
      const CACHE_KEY = "qotd-cache-v1";
      const today = new Date().toISOString().slice(0,10);

      const setQuote = (q, a) => {
        textEl.textContent   = `‚Äú${q}‚Äù`;
        authorEl.textContent = a ? `‚Äî ${a}` : "‚Äî Unknown";
      };

      const fallback = [
        { q: "The only way to do great work is to love what you do.", a: "Steve Jobs" },
        { q: "Quality is not an act, it is a habit.", a: "Aristotle" },
        { q: "Education is the most powerful weapon which you can use to change the world.", a: "Nelson Mandela" },
        { q: "What we think, we become.", a: "Buddha" },
      ];

      async function fetchQuote(force = false) {
        if (!force) {
          try {
            const cached = JSON.parse(localStorage.getItem(CACHE_KEY) || "null");
            if (cached && cached.date === today) {
              setQuote(cached.q, cached.a);
              return;
            }
          } catch {}
        }

        try {
          const res = await fetch("https://zenquotes.io/api/today");
          if (!res.ok) throw new Error("not ok");
          let data = await res.json();
          let { q, a } = Array.isArray(data) ? data[0] : data;

          if (!q) {
            const r = await fetch("https://zenquotes.io/api/random");
            data = await r.json();
            ({ q, a } = Array.isArray(data) ? data[0] : data);
          }

          setQuote(q, a);
          localStorage.setItem(CACHE_KEY, JSON.stringify({ q, a, date: today }));
        } catch {
          const pick = fallback[Math.floor(Math.random() * fallback.length)];
          setQuote(pick.q, pick.a);
        }
      }

      btn?.addEventListener("click", () => fetchQuote(true));
      fetchQuote();
    })();
  </script>
</section>
  <!-- ========================= ARTICLES ========================= -->
  <section id="articles" class="py-10 md:py-14">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <div class="flex items-end justify-between gap-4">
        <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight text-gray-900">
          Latest Articles
        </h2>
        <a href="/articles" class="text-sm text-[var(--brand)] hover:underline">Lihat semua</a>
      </div>

      <div class="mt-6 grid gap-6 md:grid-cols-2">
        {posts.map((p) => (
          <a href={`/articles/${p.slug}/`}
             class="block rounded-2xl ring-1 ring-gray-200/70 bg-white p-5 hover:shadow-lg transition">
            <h3 class="text-lg font-semibold text-[var(--brand)]">{p.data.title}</h3>
            {p.data.date && <p class="text-xs text-gray-500 mt-1">
              {new Date(p.data.date).toLocaleDateString("id-ID")}
            </p>}
            {p.data.summary && <p class="text-sm text-gray-600 mt-2 line-clamp-3">{p.data.summary}</p>}
            <span class="mt-3 inline-flex items-center gap-1 text-sm text-[var(--brand)]">
              Baca selengkapnya
              <svg viewBox="0 0 20 20" class="h-4 w-4"><path d="M7 5l5 5-5 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </span>
          </a>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>
