---
import Base from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';
const posts = (await getCollection('posts')).sort((a,b)=> (a.data.date<b.data.date?1:-1)).slice(0,3);
const courses = await getCollection('courses');
---
<Base title="Muhayat Techlabs â€” Home">
  <Nav />

  <section class="py-12">
    <div class="max-w-6xl mx-auto px-4 grid md:grid-cols-2 gap-8 items-center">
      <div>
        <p class="text-xs font-semibold uppercase tracking-wider text-emerald-700">Website Development & Teaching</p>
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-gray-900 mt-2">Welcome <span id="username">Guest</span> to <span class="text-emerald-700">Muhayat Techlabs</span></h1>
        <p class="text-gray-700 mt-4 leading-relaxed">Repository materi kuliah, artikel, dan pengumuman. Cepat, aman, SEO-friendly.</p>
        <div class="mt-5 flex gap-3">
          <a href="/courses/" class="px-5 py-2 rounded-xl bg-emerald-600 text-white font-medium hover:bg-emerald-700 transition">Lihat Courses</a>
          <a href="/posts/" class="px-5 py-2 rounded-xl bg-white ring-1 ring-emerald-600/30 text-emerald-700 font-medium hover:bg-white transition">Artikel Terbaru</a>
        </div>
      </div>
      <div class="rounded-3xl ring-1 ring-black/5 shadow-md overflow-hidden">
        <img src="https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?auto=format&fit=crop&w=1400&q=60" alt="Hero" class="w-full h-72 object-cover">
      </div>
    </div>
  </section>

  <section class="py-10 bg-gradient-to-b from-white to-emerald-50/50 border-y border-emerald-100">
    <div class="max-w-6xl mx-auto px-4">
      <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight text-gray-900 mb-6">Courses</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {courses.map(c => (
          <a href={`/courses/${c.slug}/`} class="block rounded-2xl ring-1 ring-gray-200/60 bg-white p-4 shadow-sm hover:shadow-md transition">
            <h3 class="font-semibold text-gray-900">{c.data.title}</h3>
            {c.data.code && <p class="text-xs text-gray-500 mt-1">{c.data.code}</p>}
            {c.data.description && <p class="text-sm text-gray-600 mt-2">{c.data.description}</p>}
          </a>
        ))}
      </div>
    </div>
  </section>

  <section class="py-10">
    <div class="max-w-6xl mx-auto px-4">
      <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight text-gray-900 mb-6">Latest Articles</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {posts.map(p => (
          <a href={`/posts/${p.slug}/`} class="block rounded-2xl ring-1 ring-gray-200/60 bg-white p-4 shadow-sm hover:shadow-md transition">
            <h3 class="font-semibold text-gray-900">{p.data.title}</h3>
            <p class="text-xs text-gray-500 mt-1">{p.data.date}</p>
            {p.data.summary && <p class="text-sm text-gray-600 mt-2">{p.data.summary}</p>}
          </a>
        ))}
      </div>
    </div>
  </section>

  <Footer />

  <!-- First-visit visitor modal -->
  <div id="visitor-modal" class="fixed inset-0 z-40 hidden">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
    <div class="relative mx-auto mt-28 w-[90%] max-w-md rounded-2xl bg-white shadow-xl ring-1 ring-black/10 p-5">
      <header class="mb-3">
        <h3 class="text-lg font-semibold text-gray-900">Selamat datang di <span class="text-emerald-700">Muhayat Techlabs</span></h3>
        <p class="text-sm text-gray-600">Sebutkan nama Anda untuk personalisasi sapaan (opsional).</p>
      </header>
      <form id="visitor-modal-form" class="grid gap-3" novalidate>
        <div>
          <label for="visitor-modal-input" class="block text-sm font-medium text-gray-700 mb-1">Nama</label>
          <input type="text" id="visitor-modal-input" class="w-full rounded-xl border border-gray-300 px-4 py-2 outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Nama Anda" required>
          <p id="visitor-modal-fb" class="text-[12px] text-gray-500 mt-1">Minimal 2 karakter.</p>
        </div>
        <div class="flex gap-2 justify-end pt-1">
          <button type="button" id="visitor-modal-skip" class="px-5 py-2 rounded-xl bg-white ring-1 ring-emerald-600/30 text-emerald-700 font-medium hover:bg-white">Lewati</button>
          <button type="submit" class="px-5 py-2 rounded-xl bg-emerald-600 text-white font-medium hover:bg-emerald-700">Simpan</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module">
    const usernameSpan = document.getElementById('username');
    const modal = document.getElementById('visitor-modal');
    const form  = document.getElementById('visitor-modal-form');
    const input = document.getElementById('visitor-modal-input');
    const skip  = document.getElementById('visitor-modal-skip');
    const fb    = document.getElementById('visitor-modal-fb');

    function setName(name) {
      try { localStorage.setItem('visitor_name', name); } catch {}
      if (usernameSpan) usernameSpan.textContent = name || 'Guest';
    }
    let saved = null;
    try { saved = localStorage.getItem('visitor_name'); } catch {}

    setName(saved && saved.trim().length >= 2 ? saved.trim() : 'Guest');
    function openModal(){ modal?.classList.remove('hidden'); document.documentElement.classList.add('overflow-hidden'); setTimeout(()=>input?.focus(),50); }
    function closeModal(){ modal?.classList.add('hidden'); document.documentElement.classList.remove('overflow-hidden'); }

    if (!(saved && saved.trim().length >= 2)) openModal();

    form?.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = (input?.value || '').trim();
      if (name.length < 2) { if (fb){ fb.textContent='Nama minimal 2 karakter.'; fb.className='text-[12px] text-red-600 mt-1'; } return; }
      if (fb){ fb.textContent='Tersimpan. Selamat datang!'; fb.className='text-[12px] text-green-600 mt-1'; }
      setName(name); closeModal();
    });
    skip?.addEventListener('click', () => { setName('Guest'); closeModal(); });
    modal?.addEventListener('click', (e) => { if (e.target === modal) { setName('Guest'); closeModal(); } });
  </script>
</Base>
