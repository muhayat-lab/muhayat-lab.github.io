---
import Base from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro'];
---
<Base title="Search â€” Muhayat Techlabs">
  <Nav />
  <main class="max-w-4xl mx-auto px-4 py-10">
    <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight text-gray-900 mb-6">Search</h1>
    <input id="q" type="text" placeholder="Cari artikel atau course..." class="w-full rounded-xl border border-gray-300 px-4 py-2 outline-none focus:ring-2 focus:ring-emerald-500" />
    <div id="results" class="mt-6 grid gap-3"></div>
  </main>
  <Footer />

  <script type="module">
    import MiniSearch from 'minisearch';
    const input = document.getElementById('q');
    const results = document.getElementById('results');
    const data = await fetch('/api/search.json').then(r=>r.json());
    const mini = new MiniSearch({ fields: ['title', 'summary', 'description', 'code', 'tags'], storeFields: ['title','slug','type','summary','description'] });
    mini.addAll(data);

    function render(list){
      results.innerHTML = '';
      if (!list.length){ results.innerHTML = '<p class="text-sm text-gray-500">Tidak ada hasil.</p>'; return; }
      for (const item of list){
        const a = document.createElement('a');
        a.href = item.slug;
        a.className = 'block rounded-2xl ring-1 ring-gray-200/60 bg-white p-4 shadow-sm hover:shadow-md transition';
        a.innerHTML = `<div class="text-xs text-gray-500 mb-1">${item.type.toUpperCase()}</div>
                       <div class="font-semibold text-gray-900">${item.title}</div>
                       ${item.summary ? `<div class="text-sm text-gray-600 mt-1">${item.summary}</div>` : ''}
                       ${item.description ? `<div class="text-sm text-gray-600 mt-1">${item.description}</div>` : ''}`;
        results.appendChild(a);
      }
    }
    render(data.slice(0, 10));
    input?.addEventListener('input', () => {
      const q = input.value.trim();
      if (!q) return render(data.slice(0, 10));
      const hits = mini.search(q, { prefix: true, fuzzy: 0.2 });
      render(hits.map(h => h));
    });
  </script>
</Base>
